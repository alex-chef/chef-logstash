#
# Generated by Chef
#
# logstash - Logstash Service
#
description     "Logstash"

start on filesystem or runlevel [2345]
stop on runlevel [!2345]

# Increase default timeout before killing (on stop) to 10 seconds
kill timeout 50

setuid <%= node['logstash']['user'] %>
setgid <%= node['logstash']['group'] %>
respawn limit 15 5
kill signal HUP

pre-start script
  test -f <%= node['logstash']['install_path'] %>/logstash.jar || { stop; exit 0; }
  test -d <%= node['logstash']['config_path'] %> || { stop; exit 0; }
  test -d <%= node['logstash']['log_path'] %> || { stop; exit 0; }
end script

exec <%= node['logstash']['listen_ports'].any? {|l| l <= 1024 } ? '/usr/bin/authbind --deep ' : '' %><%= node['java']['java_home'] %>/bin/java -jar <%= node['logstash']['install_path'] %>/logstash.jar agent --config <%= node['logstash']['config_path'] %> --log <%= node['logstash']['log_path'] %>/logstash.log
